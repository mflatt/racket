
srcdir = @srcdir@

CC = @CC@
CFLAGS = @CFLAGS@ @CPPFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

RKTIO_HEADERS = $(srcdir)/rktio.h $(srcdir)/rktio_private.h rktio_config.h

OBJS = rktio_fs.o \
       rktio_fd.o \
       rktio_file.o \
       rktio_poll_set.o \
       rktio_ltps.o \
       rktio_network.o \
       rktio_process.o \
       rktio_envvars.o \
       rktio_fs_change.o \
       rktio_error.o \
       rktio_main.o

all: $(OBJS)

demo: rktio_demo
	./rktio_demo

rktio_demo: $(OBJS) demo.o demo_fifo
	$(CC) -o rktio_demo $(CFLAGS) $(LDFLAGS) demo.o $(OBJS) $(LIBS)

demo_fifo:
	mkfifo demo_fifo

rktio_fs.o: $(srcdir)/rktio_fs.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fs.o -c $(srcdir)/rktio_fs.c

rktio_fd.o: $(srcdir)/rktio_fd.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fd.o -c $(srcdir)/rktio_fd.c

rktio_file.o: $(srcdir)/rktio_file.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_file.o -c $(srcdir)/rktio_file.c

rktio_poll_set.o: $(srcdir)/rktio_poll_set.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_poll_set.o -c $(srcdir)/rktio_poll_set.c

rktio_ltps.o: $(srcdir)/rktio_ltps.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_ltps.o -c $(srcdir)/rktio_ltps.c

rktio_network.o: $(srcdir)/rktio_network.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_network.o -c $(srcdir)/rktio_network.c

rktio_process.o: $(srcdir)/rktio_process.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_process.o -c $(srcdir)/rktio_process.c

rktio_envvars.o: $(srcdir)/rktio_envvars.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_envvars.o -c $(srcdir)/rktio_envvars.c

rktio_fs_change.o: $(srcdir)/rktio_fs_change.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fs_change.o -c $(srcdir)/rktio_fs_change.c

rktio_error.o: $(srcdir)/rktio_error.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_error.o -c $(srcdir)/rktio_error.c

rktio_main.o: $(srcdir)/rktio_main.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_main.o -c $(srcdir)/rktio_main.c

demo.o: $(srcdir)/demo.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o demo.o -c $(srcdir)/demo.c

clean:
	rm -f $(OBJS) rktio_demo
