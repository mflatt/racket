
srcdir = @srcdir@

CC = @CC@
CFLAGS = @CFLAGS@ @CPPFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
RKTLINKER = @RKTLINKER@

NICEAR = $(srcdir)/../utils/nicear
STATIC_AR = @STATIC_AR@
ARFLAGS = @ARFLAGS@
RANLIB = @RANLIB@

RKTIO_HEADERS = $(srcdir)/rktio.h $(srcdir)/rktio_private.h rktio_config.h

OBJS = rktio_fs.@LTO@ \
       rktio_fd.@LTO@ \
       rktio_file.@LTO@ \
       rktio_poll_set.@LTO@ \
       rktio_ltps.@LTO@ \
       rktio_network.@LTO@ \
       rktio_pipe.@LTO@ \
       rktio_process.@LTO@ \
       rktio_envvars.@LTO@ \
       rktio_fs_change.@LTO@ \
       rktio_flock.@LTO@ \
       rktio_time.@LTO@ \
       rktio_error.@LTO@ \
       rktio_hash.@LTO@ \
       rktio_wide.@LTO@ \
       rktio_main.@LTO@

librktio.@LTA@: $(OBJS)
	$(NICEAR) $(STATIC_AR) $(ARFLAGS) librktio.@LTA@ $(OBJS)
	$(RANLIB) librktio.@LTA@

demo: rktio_demo
	./rktio_demo $(ARGS)

rktio_demo: librktio.@LTA@ demo.@LTO@
	$(RKTLINKER) -o rktio_demo $(CFLAGS) $(LDFLAGS) demo.@LTO@ librktio.@LTA@ $(LIBS)

rktio_fs.@LTO@: $(srcdir)/rktio_fs.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fs.@LTO@ -c $(srcdir)/rktio_fs.c

rktio_fd.@LTO@: $(srcdir)/rktio_fd.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fd.@LTO@ -c $(srcdir)/rktio_fd.c

rktio_file.@LTO@: $(srcdir)/rktio_file.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_file.@LTO@ -c $(srcdir)/rktio_file.c

rktio_poll_set.@LTO@: $(srcdir)/rktio_poll_set.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_poll_set.@LTO@ -c $(srcdir)/rktio_poll_set.c

rktio_ltps.@LTO@: $(srcdir)/rktio_ltps.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_ltps.@LTO@ -c $(srcdir)/rktio_ltps.c

rktio_network.@LTO@: $(srcdir)/rktio_network.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_network.@LTO@ -c $(srcdir)/rktio_network.c

rktio_pipe.@LTO@: $(srcdir)/rktio_pipe.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_pipe.@LTO@ -c $(srcdir)/rktio_pipe.c

rktio_process.@LTO@: $(srcdir)/rktio_process.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_process.@LTO@ -c $(srcdir)/rktio_process.c

rktio_envvars.@LTO@: $(srcdir)/rktio_envvars.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_envvars.@LTO@ -c $(srcdir)/rktio_envvars.c

rktio_fs_change.@LTO@: $(srcdir)/rktio_fs_change.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_fs_change.@LTO@ -c $(srcdir)/rktio_fs_change.c

rktio_flock.@LTO@: $(srcdir)/rktio_flock.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_flock.@LTO@ -c $(srcdir)/rktio_flock.c

rktio_time.@LTO@: $(srcdir)/rktio_time.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_time.@LTO@ -c $(srcdir)/rktio_time.c

rktio_error.@LTO@: $(srcdir)/rktio_error.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_error.@LTO@ -c $(srcdir)/rktio_error.c

rktio_hash.@LTO@: $(srcdir)/rktio_hash.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_hash.@LTO@ -c $(srcdir)/rktio_hash.c

rktio_wide.@LTO@: $(srcdir)/rktio_wide.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_wide.@LTO@ -c $(srcdir)/rktio_wide.c

rktio_main.@LTO@: $(srcdir)/rktio_main.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o rktio_main.@LTO@ -c $(srcdir)/rktio_main.c

demo.@LTO@: $(srcdir)/demo.c $(RKTIO_HEADERS)
	$(CC) $(CFLAGS) -I$(srcdir) -I. -o demo.@LTO@ -c $(srcdir)/demo.c

clean:
	rm -f $(OBJS) librktio.@LTA@ rktio_demo demo_fifo
